---
title: "**Tree Map**"
---

------------------------------------------------------------------------

The Tree Map from the Coe College Tree Archive is the easiest way to learn more about the trees around Coe's campus. The interactive nature of the Tree Map makes it a flexible and fast tool to help connect individuals on Coe's campus with the trees around them.

<br>

```{r,  results='hide'}
#| error: false
#| echo: false
#| message: false
#| warning: false

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
## Set-Up ----------------------------------------------------------------------
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# All packages needed
my_packages <- c(
  'tidyverse',
  'sf',
  'openxlsx',
  'tmap',
  'leaflet',
  'leaflet.extras'
)

# Install any packages not already installed
new_packages <- my_packages[!(my_packages %in% installed.packages()[,"Package"])]
if(length(new_packages)){
  install.packages(new_packages)
}

# Library all packages
lapply(my_packages, library, character.only = TRUE)

# Reduce scientific notation
options(scipen = 9)

# Remove unnecessary objects
rm(new_packages, my_packages)

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

```

```{r}
#| error: false
#| echo: false
#| message: false
#| warning: false

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
## Formatting Set Up -----------------------------------------------------------
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

tree_shp <- read.xlsx("data/coe-tree-archive-all-years.xlsx", detectDates = T) 

# Formatting the names of planters
format_names <- function(x){
  if(is.na(x)){
    output = "Unknown"
  } else {
    output = str_replace_all(x, pattern = ", ", replacement="<br>")
    output = paste("<br>", output, sep="")
  }
  return(output)
}

# Setting up the tree icons
treeIcons <- iconList(  
  Oak = makeIcon(
    iconUrl = "images/map-icons/oak.png", iconWidth = 25, iconHeight = 50),
  Maple = makeIcon(
    iconUrl = "images/map-icons/maple.png", iconWidth = 25, iconHeight = 50), 
  `Honey Locust` = makeIcon(
    iconUrl = "images/map-icons/honeylocust.png", iconWidth = 25, iconHeight = 50),
  Elm = makeIcon(
    iconUrl = "images/map-icons/elm.png", iconWidth = 25, iconHeight = 50), 
  Ash = makeIcon(
    iconUrl = "images/map-icons/ash.png", iconWidth = 25, iconHeight = 50),
  Evergreen = makeIcon(
    iconUrl = "images/map-icons/evergreen.png", iconWidth = 25, iconHeight = 50),
  Crabapple = makeIcon(
    iconUrl = "images/map-icons/crabapple.png", iconWidth = 25, iconHeight = 50),
  Other = makeIcon(
    iconUrl = "images/map-icons/other.png", iconWidth = 25, iconHeight = 50)
)

icon_legend <- "<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/oak.png'
style='width:15px;height:30px;'>\tOak<br/>

<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/maple.png'
style='width:15px;height:30px;'>\tMaple<br/>

<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/honeylocust.png'
style='width:15px;height:30px;'>\tHoney Locust<br/>

<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/elm.png' style='width:15px;height:30px;'>\tElm<br/>

<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/ash.png' style='width:15px;height:30px;'>\tAsh<br/>

<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/evergreen.png'
style='width:15px;height:30px;'>\tEvergreen<br/>

<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/crabapple.png'
style='width:15px;height:30px;'>\tCrabapple<br/>

<img src='https://raw.githubusercontent.com/CoeTreeArchive/CoeTreeArchive.github.io/main/images/map-icons/other.png'
style='width:15px;height:30px;'>\tOther
"

# Processing
tree_shp  <- tree_shp %>% 
  rowwise %>% 
  mutate(
    formatted_names = format_names(Planters),
    Name = ifelse(is.na(Name), 'Unnamed', Name),
    my_url = paste(
      "https://coetreearchive.github.io/tree-profiles/tree_", Tree.ID, ".html", 
      sep="")
  )

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# The Map ----------------------------------------------------------------------
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

tree_shp <- st_as_sf(tree_shp, coords = c('Longitude','Latitude'), 
                     crs = 'WGS84')

leaflet(tree_shp,
        options = leafletOptions(minZoom = 15, maxZoom = 20, maxNativeZoom=20)) %>%
  addMarkers(
    icon = ~treeIcons[Species.Group],
    group = ~Series,
    label = ~paste(Tree.ID, Identification, Name, sep = ' - '),
    labelOptions = labelOptions(opacity = 0),
    popup = ~paste(
      "<h3>", Identification, "</h3>",
      "<hr> </hr>",
      "<table>
        <tr>
        <th>Tree ID#:</th>
        <th>", Tree.ID, "</th>
        </tr>",
      "<tr>
        <td>Name:</td>
        <td>", Name, "</td>
        </tr>",
      "<tr>
        <td>Diameter (in):</td>
        <td>", `DBH.(in)`, "</td>
        </tr>",
      "<tr>
        <td>Carbon Storage (lbs):</td>
        <td>", `Carbon.Storage.(lb)`, "</td>
        </tr>",
      "<tr>
        <td>Avoided Runoff (gal/year):</td>
        <td>", `Avoided.Runoff.(gal/yr)`, "</td>
        </tr>",
      "<tr>
        <td>Pollution Removal (oz/year):</td>
        <td>", `Pollution.Removal.(oz/yr)`, "</td>
        </tr>",
      "<tr>
        <td>Planted By:</td>
        <td>", formatted_names, "</td>
        </tr>",
      "</table>",
      "<a href=", my_url, ">More About This Tree</a>"
    )
  ) %>%
  addResetMapButton() %>%
  addFullscreenControl()%>%
  addProviderTiles(providers$OpenStreetMap.France) %>%
  addControl(html = icon_legend, position = "bottomleft") %>%
  addLayersControl(overlayGroups = unique(tree_shp$Series)) %>%
  addSearchFeatures(
    targetGroups = unique(tree_shp$Series),
    options = searchFeaturesOptions(
      openPopup = T,
      zoom = 20,
      hideMarkerOnCollapse = T,
      position = "topright",
      textPlaceholder = "Search Tree ID, species, or name")
  )

```

<br>

## **How to Use the Tree Map**

|                                                                        |                                                                                                                         |
|:----------------:|------------------------------------------------------|
|    ![](images/map-icons/map-features/zoom.png){fig-align="center"}     | Use this icon, your finger, or your mousepad to zoom in and zoom out on the map.                                        |
| ![](images/map-icons/map-features/full-screen.png){fig-align="center"} | Click on this icon to expand the map to full screen.                                                                    |
| ![](images/map-icons/map-features/reset-view.png){fig-align="center"}  | Click on this icon to reset the map to its original view.                                                               |
|    ![](images/map-icons/map-features/tiles.png){fig-align="center"}    | Select the data series you would like to see on the map. (Currently, Fall 2022 is the only data series available.)      |
|   ![](images/map-icons/map-features/search.png){fig-align="center"}    | Click on this icon and enter a Tree ID, tree species, or tree name, then select a tree and find its location on campus. |

## **About the Tree Map**

In addition to identification information, the Tree Map displays estimates of some of the tangible benefits individual trees offer us, including carbon sequestration, avoided runoff, and reductions in air pollution. These estimates all come from [i-Tree Eco](https://www.itreetools.org/about), a software product supported by the US Forest Service. For more detailed data on the trees, see the [Data](/data.qmd) tab.

The Tree Map also displays the names, if available, of anyone who helped plant a tree. Many trees planted after the derecho have a metal tag that display the names of the members of the Coe community who helped plant the tree. The Tree Map contains these names as a way to celebrate those who helped rebuild our campus, and to help us all appreciate the opportunities we have support others through nature.

Tree names are all tree-related puns based on the names of Coe's staff and faculty. Click the button to learn more about tree names and to view the full list of named trees.

<center><a class="button" href="https://coetreearchive.github.io/tree-names.html">View All Tree Names</a></center>

<br>

You can also learn more about an individual tree by visiting its [Tree profile](tree-profile.html) and learn more about the data from all trees on campus by visiting the [Data](data.html) page.
