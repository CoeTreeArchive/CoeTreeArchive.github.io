---
title: "**Where can our trees help avoid runoff?**"
description: "Interactive heat map of estimated avoided runoff across campus"
image: "../../images/tree-profiles/not-available.PNG"
---

```{r, results = 'hide'}
#| error: false
#| echo: false
#| message: false
#| warning: false

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
## Set-Up ----------------------------------------------------------------------
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# All packages needed
my_packages <- c(
  'tidyverse',
  'openxlsx',
  'plotly',
  'leaflet',
  'leaflet.extras',
  'sf'
)

# Install any packages not already installed
new_packages <- my_packages[!(my_packages %in% installed.packages()[,"Package"])]
if(length(new_packages)){
  install.packages(new_packages)
}

# Library all packages
lapply(my_packages, library, character.only = TRUE)

# Reduce scientific notation
options(scipen = 9)

# Remove unnecessary objects
rm(new_packages, my_packages)

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
```

```{r}
#| error: false
#| echo: false
#| message: false
#| warning: false

df <- read.xlsx('../../data/coe-tree-archive-all-years.xlsx')

df <- df %>% 
  rowwise() %>% 
  mutate(
    Species.Group = case_when(
      Identification == "Unidentified" ~ "Unidentified",
      T ~ Species.Group
    )
  )

tree_shp <- st_as_sf(df, coords = c('Longitude','Latitude'), 
                     crs = 'WGS84', remove = F)

fig3 <- leaflet(tree_shp, 
        options = leafletOptions(minZoom = 15, maxZoom = 18, maxNativeZoom=20)) %>%
  addProviderTiles(providers$OpenStreetMap.France) %>% 
  addHeatmap(
    lng = ~Longitude, lat = ~Latitude, intensity = ~`Avoided.Runoff.(gal/yr)`,
    blur = 20, max = 1000, radius = 25
  ) %>% 
  addResetMapButton() %>%
  addFullscreenControl()
```

```{r}
#| echo: false

fig3
```
